<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head th:replace="~{fragments/head :: head('Admin - Invoices')}"></head>

<body>
  <div th:replace="~{fragments/nav :: nav}"></div>
  <div class="container">
    <h1 style="margin: 30px 0;">Manage Invoices</h1>
    <a href="/admin" style="text-decoration: none;">← Back to Dashboard</a>

    <div th:if="${success}" class="alert alert-success" th:text="${success}"></div>
    <div th:if="${error}" class="alert alert-error" th:text="${error}"></div>

    <table class="card" style="padding: 0; margin-top: 20px;">
      <thead>
        <tr>
          <th>ID</th>
          <th>Booking</th>
          <th>User</th>
          <th>Nights</th>
          <th>Total</th>
          <th>Status</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr th:each="inv : ${invoices}">
          <td th:text="${inv.id}"></td>
          <td th:text="${inv.bookingId}"></td>
          <td th:text="${inv.userId}"></td>
          <td th:text="${inv.nights}"></td>
          <td th:text="'$' + ${inv.total}"></td>
          <td>
            <span class="status" th:classappend="'status-' + ${inv.status.name().toLowerCase()}"
              th:text="${inv.status}"></span>
          </td>
          <td>
            <form th:if="${inv.status.name() == 'PENDING_PAYMENT'}"
              th:action="@{/admin/invoices/{id}/cash-paid(id=${inv.id})}" method="post" style="display: inline;">
              <button type="submit" class="btn btn-success">Mark Cash Paid</button>
            </form>
            <span th:if="${inv.status.name() == 'PAID'}" style="color: green;">✓ Paid</span>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</body>

</html>